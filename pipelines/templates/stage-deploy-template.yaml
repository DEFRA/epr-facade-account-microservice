#resources:
#  repositories:
#    - repository: AutomationTesting
#      name: RWD-CPR-EPR4P-ADO/epr-playwright-bdd
#      type: git
#      ref: automation-testing-sam
      
stages:
  - stage: DeployToDev4Regulators
    jobs:
      - job: DeployToDev4Regulators
        displayName: DeployToDev4 (Regulators)
        condition: and(succeeded(), eq(variables['build.sourceBranch'], 'refs/heads/main'))
        steps:
          - template: templates/deployment.yaml@CommonTemplates
            parameters:
              imageTag: 'main-latest'
              azureSubscription: 'AZD-RWD-DEV4'
              acrName: 'devrwdinfac1401'
              registryName: 'facadeaccountcreationrepository'
              serviceName: 'devrwdwebwa4413'
              targetEnvironment: 'development'
              
      - job: RunAutomationTest
        displayName: DEV4 Automation Testing
        dependsOn: DeployLatestMainDev4
        pool: DEFRA-COMMON-ubuntu2004-SSV3
        steps:
          - checkout: AutomationTesting
          - template: automation-testing.yaml@AutomationTesting
